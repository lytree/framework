<?xml version="1.0" encoding="utf-8"?>
<nlog xmlns="http://www.nlog-project.org/schemas/NLog.xsd"
	  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">

	<!-- 全局设置 -->
	<targets>

		<!-- 异步包装器：所有 File 写入都经过异步队列 -->
		<target xsi:type="AsyncWrapper" name="asyncFile"
				overflowAction="Discard"
				batchSize="200"
				timeToSleepBetweenBatches="50"/>

		<!-- 真正的文件目标 -->
		<target xsi:type="File"
				name="dailyRollingFile"
				fileName="${baseDir}/logs/app.${shortdate}.log"
				layout="${date:format=yyyy-MM-dd HH:mm:ss}|${level:uppercase=true}|${logger}:[${callsite}(${callsite-linenumber})]|${message} ${exception:format=message,stacktrace}"
			
			    archiveEvery="Day"
			    
			    archiveAboveSize="10485760"
			    
			    archiveNumbering="Rolling"
			    
			    archiveFileName="${baseDir}logs/archives/app.${date:format=yyyy-MM-dd}.{#}.log"
			    
			    maxArchiveFiles="50"
			    
			    concurrentWrites="true"
			    	
			    keepFileOpen="false"
			    	
			    encoding="utf-8"
			    	
			    enableArchiveFileCompression="true"
			/>

		<!-- 也可以单独给控制台输出异步 -->
		<target xsi:type="AsyncWrapper" name="asyncConsole">
			<target xsi:type="ColoredConsole"
					layout="${date:format=yyyy-MM-dd HH:mm:ss}|${level:uppercase=true}|${logger}:[${callsite}(${callsite-linenumber})]|${message}" />
			<highlight-row condition="level == LogLevel.Error" foregroundColor="Red" />
			<highlight-row condition="level == LogLevel.Warn" foregroundColor="Yellow" />
		</target>

	</targets>

	<rules>
		<!-- 所有日志 >= Info 写到控制台 -->
		<logger name="*" minlevel="Info" writeTo="asyncConsole" />

		<!-- 所有日志 >= Debug 写到文件 -->
		<logger name="*" minlevel="Debug" writeTo="asyncFile" />
	</rules>
</nlog>
